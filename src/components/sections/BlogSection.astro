---
import Badge from "@/components/ui/badge/Badge.astro";
import blogData from "@/data/sections/blog.json";

// Sort posts by date (newest first) and filter published only
const posts = blogData.posts
  .filter((post: { published: boolean }) => post.published)
  .sort((a: { date: string }, b: { date: string }) => new Date(b.date).getTime() - new Date(a.date).getTime());

function formatDate(dateStr: string) {
  return new Date(dateStr).toLocaleDateString('en-US', {
    year: 'numeric',
    month: 'long',
    day: 'numeric'
  });
}
---

<section id="blog" class="py-20 sm:py-24">
  <div class="mx-auto max-w-4xl px-6 lg:px-8">
    <div class="mb-12">
      <h2 class="text-3xl font-bold tracking-tight sm:text-4xl text-foreground">
        {blogData.sectionTitle}
      </h2>
      {blogData.description && (
        <p class="mt-3 text-lg text-muted-foreground">{blogData.description}</p>
      )}
    </div>

    <div class="space-y-6">
      {posts.map((post: { title: string; excerpt: string; date: string; tags: string[]; slug: string }) => (
        <a href={`/blog/${post.slug}`} class="block group">
          <article class="rounded-xl border border-border bg-card p-6 shadow-sm hover:shadow-md transition-all duration-300 hover:border-primary/20">
            <div class="flex flex-wrap items-start justify-between gap-2 mb-3">
              <div class="flex-1 min-w-0">
                <h3 class="text-lg font-semibold text-foreground group-hover:text-primary transition-colors">
                  {post.title}
                </h3>
                <time class="text-xs text-muted-foreground" datetime={post.date}>
                  {formatDate(post.date)}
                </time>
              </div>
            </div>

            <p class="text-sm text-muted-foreground mb-4 line-clamp-2">{post.excerpt}</p>

            <div class="flex items-center justify-between">
              {post.tags && post.tags.length > 0 && (
                <div class="flex flex-wrap gap-1.5">
                  {post.tags.map((tag: string) => (
                    <Badge variant="outline" class="text-xs">{tag}</Badge>
                  ))}
                </div>
              )}
              <span class="text-sm font-medium text-primary opacity-0 group-hover:opacity-100 transition-opacity">
                Read more â†’
              </span>
            </div>
          </article>
        </a>
      ))}

      {posts.length === 0 && (
        <div class="rounded-xl border border-dashed border-border bg-muted/30 p-12 text-center">
          <p class="text-muted-foreground">No posts yet. Add your first post from the CMS!</p>
        </div>
      )}
    </div>
  </div>
</section>
