---
/**
 * Seo.astro - Main SEO component using @astrolib/seo
 * Handles meta tags, Open Graph, and Twitter Cards
 */
import { AstroSeo } from "@astrolib/seo";
import { siteConfig } from "@/config/site";

export interface Props {
  title?: string;
  description?: string;
  canonical?: string;
  image?: string;
  imageAlt?: string;
  noindex?: boolean;
  nofollow?: boolean;
  type?: "website" | "article";
  publishedTime?: string;
  modifiedTime?: string;
  author?: string;
  section?: string;
  tags?: string[];
}

const {
  title = siteConfig.name,
  description = siteConfig.description,
  canonical = Astro.url.href,
  image = siteConfig.ogImage,
  imageAlt = `${siteConfig.name} - ${description}`,
  noindex = false,
  nofollow = false,
  type = "website",
  publishedTime,
  modifiedTime,
  author = siteConfig.author.name,
  section,
  tags = [],
} = Astro.props;

// Construct full title
const fullTitle =
  title === siteConfig.name ? title : `${title} | ${siteConfig.name}`;

// Ensure absolute URLs
const absoluteImage = image.startsWith("http")
  ? image
  : `${siteConfig.url}${image}`;
const absoluteCanonical = canonical.startsWith("http")
  ? canonical
  : `${siteConfig.url}${canonical}`;

// Build Open Graph config
const openGraph: Record<string, any> = {
  url: absoluteCanonical,
  title: fullTitle,
  description,
  images: [
    {
      url: absoluteImage,
      width: 1200,
      height: 630,
      alt: imageAlt,
      type: "image/jpeg",
    },
  ],
  site_name: siteConfig.name,
  type,
  locale: "en_US",
};

// Add article-specific Open Graph data
if (type === "article") {
  openGraph.article = {
    publishedTime,
    modifiedTime,
    authors: [author],
    section,
    tags,
  };
}
---

<AstroSeo
  title={fullTitle}
  description={description}
  canonical={absoluteCanonical}
  noindex={noindex}
  nofollow={nofollow}
  openGraph={openGraph}
  twitter={{
    handle: siteConfig.author.twitter,
    site: siteConfig.author.twitter,
    cardType: "summary_large_image",
  }}
  additionalMetaTags={[
    {
      name: "author",
      content: author,
    },
    {
      name: "theme-color",
      content: "#ffffff",
      media: "(prefers-color-scheme: light)",
    },
    {
      name: "theme-color",
      content: "#0a0a0a",
      media: "(prefers-color-scheme: dark)",
    },
  ]}
  additionalLinkTags={[
    {
      rel: "icon",
      href: "/favicon.ico",
    },
    {
      rel: "apple-touch-icon",
      href: "/apple-touch-icon.png",
      sizes: "180x180",
    },
    {
      rel: "manifest",
      href: "/site.webmanifest",
    },
  ]}
/>
