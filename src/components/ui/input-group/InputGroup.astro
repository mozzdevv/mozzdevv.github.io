---
import { cn } from "@/utils/cn";
import type { HTMLAttributes } from "astro/types";

export interface Props extends HTMLAttributes<"div"> {
  /**
   * Layout direction for the input group
   * - "inline": Horizontal layout (default, for InputGroupInput)
   * - "block": Vertical layout (for InputGroupTextarea)
   */
  layout?: "inline" | "block";
}

const { layout = "inline", class: className, ...props } = Astro.props;

const classes = cn(
  "relative flex min-w-0 rounded-md border border-input bg-background",
  layout === "inline" ? "flex-row items-stretch" : "flex-col",
  className,
);
---

<div class={classes} data-input-group data-layout={layout} {...props}>
  <slot />
</div>

<style is:global>
  /* Container focus ring when input is focused */
  [data-input-group]:has([data-slot="input-group-control"]:focus),
  [data-input-group]:has(
    [data-popover] [data-slot="input-group-control"]:focus
  ) {
    box-shadow: 0 0 0 3px oklch(var(--primary) / 0.1);
  }

  /* Remove individual borders from children in inline layout */
  [data-input-group][data-layout="inline"] > [data-slot="input-group-control"] {
    border: none;
    border-radius: 0;
    box-shadow: none;
  }
  [data-input-group][data-layout="inline"]
    > [data-popover]
    [data-slot="input-group-control"] {
    border: none;
    border-radius: 0;
    box-shadow: none;
  }

  [data-input-group][data-layout="inline"]
    > [data-slot="input-group-control"]:focus {
    box-shadow: none;
    outline: none;
  }
  [data-input-group][data-layout="inline"]
    > [data-popover]
    [data-slot="input-group-control"]:focus {
    box-shadow: none;
    outline: none;
  }

  /* First child gets left border radius */
  [data-input-group][data-layout="inline"] > *:first-child {
    border-top-left-radius: calc(0.375rem - 1px);
    border-bottom-left-radius: calc(0.375rem - 1px);
  }

  /* Last child gets right border radius */
  [data-input-group][data-layout="inline"] > *:last-child {
    border-top-right-radius: calc(0.375rem - 1px);
    border-bottom-right-radius: calc(0.375rem - 1px);
  }

  /* Addon positioning via order */
  [data-input-group][data-layout="inline"]
    > [data-input-group-addon][data-align="inline-start"] {
    order: -1;
  }

  [data-input-group][data-layout="inline"]
    > [data-input-group-addon][data-align="inline-end"] {
    order: 1;
  }

  /* Add separator between addon and input */
  [data-input-group][data-layout="inline"]
    > [data-input-group-addon][data-align="inline-start"] {
    border-right: 1px solid oklch(var(--border));
  }

  [data-input-group][data-layout="inline"]
    > [data-input-group-addon][data-align="inline-end"] {
    border-left: 1px solid oklch(var(--border));
  }

  /* Block layout children */
  [data-input-group][data-layout="block"] > [data-slot="input-group-control"] {
    border: none;
    border-radius: 0;
    box-shadow: none;
  }

  [data-input-group][data-layout="block"]
    > [data-slot="input-group-control"]:focus {
    box-shadow: none;
    outline: none;
  }

  /* First child in block layout */
  [data-input-group][data-layout="block"] > *:first-child {
    border-top-left-radius: calc(0.375rem - 1px);
    border-top-right-radius: calc(0.375rem - 1px);
  }

  /* Last child in block layout */
  [data-input-group][data-layout="block"] > *:last-child {
    border-bottom-left-radius: calc(0.375rem - 1px);
    border-bottom-right-radius: calc(0.375rem - 1px);
  }

  /* Addon positioning for block layout */
  [data-input-group][data-layout="block"]
    > [data-input-group-addon][data-align="block-start"] {
    order: -1;
    border-bottom: 1px solid oklch(var(--border));
  }

  [data-input-group][data-layout="block"]
    > [data-input-group-addon][data-align="block-end"] {
    order: 1;
    border-top: 1px solid oklch(var(--border));
  }
</style>
