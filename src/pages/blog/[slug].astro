---
import BaseLayout from '@/layouts/BaseLayout.astro';
import Badge from '@/components/ui/badge/Badge.astro';
import Button from '@/components/ui/button/Button.astro';
import blogData from '@/data/sections/blog.json';
import { marked } from 'marked';
import '@/styles/typography.css';

export function getStaticPaths() {
  return blogData.posts
    .filter((post: { published: boolean }) => post.published)
    .map((post: { slug: string }) => ({
      params: { slug: post.slug },
    }));
}

const { slug } = Astro.params;
const post = blogData.posts.find(
  (p: { slug: string; published: boolean }) => p.slug === slug && p.published
);

if (!post) {
  return Astro.redirect('/404');
}

const htmlContent = marked.parse(post.body || '');

function formatDate(dateStr: string) {
  return new Date(dateStr).toLocaleDateString('en-US', {
    year: 'numeric',
    month: 'long',
    day: 'numeric',
  });
}
---

<BaseLayout showNavigation={true} showFooter={true}>
  <article class="py-16 sm:py-20">
    <div class="mx-auto max-w-3xl px-6 lg:px-8">

      <!-- Back link -->
      <div class="mb-10">
        <Button href="/#blog" variant="ghost" size="sm">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mr-1"><path d="m15 18-6-6 6-6"/></svg>
          Back to Writings
        </Button>
      </div>

      <!-- Post header -->
      <header class="mb-12">
        <div class="flex flex-wrap gap-1.5 mb-4">
          {post.tags && post.tags.map((tag: string) => (
            <Badge variant="outline" class="text-xs">{tag}</Badge>
          ))}
        </div>

        <h1 class="text-3xl sm:text-4xl font-bold tracking-tight text-foreground mb-3">
          {post.title}
        </h1>

        <div class="flex items-center gap-3 text-sm text-muted-foreground">
          <time datetime={post.date}>{formatDate(post.date)}</time>
        </div>

        {post.excerpt && (
          <p class="mt-6 text-lg text-muted-foreground leading-relaxed border-l-4 border-primary/30 pl-4">
            {post.excerpt}
          </p>
        )}
      </header>

      <!-- Divider -->
      <hr class="border-border mb-10" />

      <!-- Post body -->
      <div class="prose max-w-none" set:html={htmlContent} />

    </div>
  </article>
</BaseLayout>
