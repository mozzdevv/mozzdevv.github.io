---
// Fundations
import DocsLayout from "@/layouts/DocsLayout.astro";
import Text from "@/components/fundations/elements/Text.astro";

import { getCollection } from "astro:content";
// Get all components from the content collection
const allComponents = await getCollection("components");

// Sort by order (if defined) then by title alphabetically
const components = allComponents.sort((a, b) => {
  // If both have order, sort by order
  if (a.data.order !== undefined && b.data.order !== undefined) {
    return a.data.order - b.data.order;
  }
  // If only one has order, that one comes first
  if (a.data.order !== undefined) return -1;
  if (b.data.order !== undefined) return 1;
  // Otherwise sort alphabetically by title
  return a.data.title.localeCompare(b.data.title);
});

// Group components by category
const categories = {
  form: { label: "Form", components: [] as typeof components },
  layout: { label: "Layout", components: [] as typeof components },
  navigation: { label: "Navigation", components: [] as typeof components },
  feedback: { label: "Feedback", components: [] as typeof components },
  disclosure: { label: "Disclosure", components: [] as typeof components },
  display: { label: "Display", components: [] as typeof components },
};

components.forEach((component) => {
  const category = component.data.category;
  if (categories[category]) {
    categories[category].components.push(component);
  }
});
---

<DocsLayout
  title="Components"
  description="Browse all available components in the library, organized by category."
>
  <div class="space-y-8">
    {
      Object.entries(categories).map(
        ([key, { label, components: categoryComponents }]) =>
          categoryComponents.length > 0 && (
            <div>
              <Text
                tag="h2"
                variant="textSM"
                class=" font-medium text-muted-foreground"
              >
                {label}
              </Text>
              <div class="grid grid-cols-2 sm:grid-cols-3 gap-x-4 gap-y-2 mt-2">
                {categoryComponents.map((component) => (
                  <a
                    href={`/docs/components/${component.slug}`}
                    class="text-sm font-medium text-foreground hover:underline"
                  >
                    {component.data.title}
                  </a>
                ))}
              </div>
            </div>
          ),
      )
    }
  </div>
</DocsLayout>
