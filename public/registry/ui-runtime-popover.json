{
  "name": "ui-runtime-popover",
  "type": "utility",
  "description": "Shared popover initialization runtime",
  "files": [
    {
      "name": "runtime/popover.ts",
      "path": "utils/runtime/popover.ts",
      "content": "import { generateId } from \"@/utils/focus-trap\";\n\nexport function initPopovers() {\n  document.querySelectorAll(\"[data-popover]\").forEach((popover) => {\n    if (popover.hasAttribute(\"data-initialized\")) return;\n    popover.setAttribute(\"data-initialized\", \"true\");\n\n    const trigger = popover.querySelector(\"[data-popover-trigger]\") as\n      | HTMLElement\n      | null;\n    const content = popover.querySelector(\"[data-popover-content]\") as\n      | HTMLElement\n      | null;\n\n    if (!trigger || !content) return;\n\n    if (!content.id) {\n      content.id = generateId(\"popover\");\n    }\n\n    trigger.setAttribute(\"aria-haspopup\", \"dialog\");\n    trigger.setAttribute(\"aria-controls\", content.id);\n    trigger.setAttribute(\"aria-expanded\", \"false\");\n\n    const openPopover = () => {\n      content.hidden = false;\n      trigger.setAttribute(\"aria-expanded\", \"true\");\n      const firstFocusable = content.querySelector(\n        'button, [href], input, select, textarea, [tabindex]:not([tabindex=\"-1\"])'\n      ) as HTMLElement | null;\n      firstFocusable?.focus();\n    };\n\n    const closePopover = () => {\n      content.hidden = true;\n      trigger.setAttribute(\"aria-expanded\", \"false\");\n      trigger.focus();\n    };\n\n    const togglePopover = () => {\n      if (content.hidden) {\n        openPopover();\n      } else {\n        closePopover();\n      }\n    };\n\n    trigger.addEventListener(\"click\", togglePopover);\n\n    document.addEventListener(\"click\", (e) => {\n      if (!popover.contains(e.target as Node) && !content.hidden) {\n        closePopover();\n      }\n    });\n\n    document.addEventListener(\"keydown\", (e) => {\n      if (e.key === \"Escape\" && !content.hidden) {\n        closePopover();\n      }\n    });\n  });\n}\n"
    }
  ]
}
